"""
Nutrition Tracker - Multi-Agent System
Built with Google Agent Development Kit (ADK)

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–ª–∞–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∏ —Å—É–±-–∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è.
"""
import os
import logging

from google.adk.agents import Agent
from google.adk.models.google_llm import Gemini
from google.genai import types

# ============================================================
# OBSERVABILITY: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–µ–π—Å–∏–Ω–≥
# ============================================================
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger("nutrition_tracker")

# OpenTelemetry —Ç—Ä–µ–π—Å–∏–Ω–≥ (—ç–∫—Å–ø–æ—Ä—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
os.environ.setdefault("OTEL_SERVICE_NAME", "nutrition_tracker")
os.environ.setdefault("OTEL_TRACES_EXPORTER", "console")
os.environ.setdefault("OTEL_METRICS_EXPORTER", "none")

logger.info("üöÄ Nutrition Tracker agent initializing...")

# Retry –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º 429/5xx
retry_config = types.HttpRetryOptions(
    attempts=5,
    exp_base=7,
    initial_delay=1,
    http_status_codes=[429, 500, 503, 504],
)

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º tools
# –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º SQLite –≤–º–µ—Å—Ç–æ Google Sheets
# from .tools.sheets_tools import (
#     save_meal,
#     get_today_meals,
#     get_meals_by_date,
#     get_week_meals,
#     get_user_goals,
#     update_user_goals,
#     delete_last_meal,
# )
from .tools.sqlite_tools import (
    save_meal,
    get_today_meals,
    get_meals_by_date,
    get_week_meals,
    get_user_goals,
    update_user_goals,
    edit_meal,
    delete_meal,
    # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ—Å–æ–º
    save_weight,
    get_weight_history,
    get_weight_nutrition_analysis,
    delete_weight,
)
from .tools.nutrition_tools import (
    analyze_food_description,
    calculate_daily_totals,
    get_nutrition_advice,
)
from .tools.memory_tools import (
    store_memory,
    recall_memories,
    forget_memory,
)
from .tools.search_tools import search_nutrition_info


# ============================================================
# SUB-AGENTS (–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã)
# ============================================================

# –ê–≥–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –µ–¥—ã –∏ —Ä–∞—Å—á–µ—Ç–∞ –ö–ë–ñ–£
nutrition_analyst = Agent(
    name="nutrition_analyst",
    model=Gemini(model="gemini-2.0-flash", retry_options=retry_config),
    description="–≠–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –µ–¥—ã –∏ —Ä–∞—Å—á–µ—Ç—É –∫–∞–ª–æ—Ä–∏–π, –±–µ–ª–∫–æ–≤, –∂–∏—Ä–æ–≤ –∏ —É–≥–ª–µ–≤–æ–¥–æ–≤.",
    instruction="""–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥-–∞–Ω–∞–ª–∏—Ç–∏–∫.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –µ–¥—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –∏—Ö –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –ø–æ—Ä—Ü–∏–∏
3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏ –∏ –ë–ñ–£ (–±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã)
4. –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏

–ü—Ä–∞–≤–∏–ª–∞:
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ (–±–∞–∑–∞ USDA)
- –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –ø–æ—Ä—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω - –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é
- –ë—É–¥—å —Ç–æ—á–Ω—ã–º –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª—é–¥–∞ —É–∫–∞–∑—ã–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω–æ –ö–ë–ñ–£

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –µ–¥—ã:
- –ü–µ—Ä–µ—á–∏—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
- –£–∫–∞–∂–∏ –∫–∞–ª–æ—Ä–∏–∏, –±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã
- –£–∫–∞–∂–∏ —Ç–∏–ø –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
""",
    tools=[analyze_food_description],
)

# –ê–≥–µ–Ω—Ç-–∫–æ—É—á –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
nutrition_coach = Agent(
    name="nutrition_coach",
    model=Gemini(model="gemini-2.0-flash", retry_options=retry_config),
    description="–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ—É—á –ø–æ –ø–∏—Ç–∞–Ω–∏—é, –¥–∞–µ—Ç –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.",
    instruction="""–¢—ã –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –∫–æ—É—á –ø–æ –ø–∏—Ç–∞–Ω–∏—é.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –µ–≥–æ —Ü–µ–ª—è–º
2. –î–∞–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —á—Ç–æ —Å—ä–µ—Å—Ç—å –¥–∞–ª—å—à–µ
3. –ú–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è:
- –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π, –Ω–æ —á–µ—Å—Ç–Ω—ã–π
- –ö—Ä–∞—Ç–∫–∏–π (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
- –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã, –Ω–µ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã

–¢–∏–ø—ã —Ü–µ–ª–µ–π:
- weight_loss: –¥–µ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π, –±–æ–ª—å—à–µ –±–µ–ª–∫–∞
- muscle_gain: –ø—Ä–æ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π, –º–Ω–æ–≥–æ –±–µ–ª–∫–∞
- maintenance: –±–∞–ª–∞–Ω—Å
""",
    tools=[get_nutrition_advice],
)

# –ê–≥–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
data_manager = Agent(
    name="data_manager",
    model=Gemini(model="gemini-2.0-flash", retry_options=retry_config),
    description="–£–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –µ–¥—ã, –≤–µ—Å, –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, —Ü–µ–ª–∏.",
    instruction="""–¢—ã –º–µ–Ω–µ–¥–∂–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è –∏ –≤–µ—Å–∞.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏–µ–º—ã –ø–∏—â–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
2. –ü–æ–ª—É—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–∏—Ç–∞–Ω–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É
3. –£–ø—Ä–∞–≤–ª—è—Ç—å —Ü–µ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –≤–µ—Å–µ

–ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—à—å –µ–¥—É:
- –ò—Å–ø–æ–ª—å–∑—É–π save_meal —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π user_id, description, calories, protein, fat, carbs

–ö–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –≤–µ—Å–æ–º:
- save_weight(user_id, weight, note) ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å (–æ–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å)
- get_weight_history(user_id, days) ‚Äî –∏—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞
- get_weight_nutrition_analysis(user_id, days) ‚Äî –∞–Ω–∞–ª–∏–∑ –≤–µ—Å–∞ –≤ —Å–≤—è–∑–∫–µ —Å –ø–∏—Ç–∞–Ω–∏–µ–º
- delete_weight(user_id, date) ‚Äî —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –≤–µ—Å–µ

–ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—à—å –∏—Å—Ç–æ—Ä–∏—é:
- –ò—Å–ø–æ–ª—å–∑—É–π get_today_meals –¥–ª—è —Å–µ–≥–æ–¥–Ω—è
- –ò—Å–ø–æ–ª—å–∑—É–π get_meals_by_date –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–π get_week_meals –¥–ª—è –Ω–µ–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: YYYY-MM-DD (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2024-11-25)
""",
    tools=[
        save_meal,
        get_today_meals,
        get_meals_by_date,
        get_week_meals,
        get_user_goals,
        update_user_goals,
        edit_meal,
        delete_meal,
        calculate_daily_totals,
        # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤–µ—Å–∞
        save_weight,
        get_weight_history,
        get_weight_nutrition_analysis,
        delete_weight,
    ],
)


# ============================================================
# ROOT AGENT (–ì–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)
# ============================================================

root_agent = Agent(
    name="nutrition_tracker",
    model=Gemini(model="gemini-2.0-flash", retry_options=retry_config),
    description="""
    AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è –∏ –≤–µ—Å–∞. 
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –µ–¥—É, —Å—á–∏—Ç–∞–µ—Ç –∫–∞–ª–æ—Ä–∏–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤–µ—Å,
    –¥–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ–± –∏—Å—Ç–æ—Ä–∏–∏.
    """,
    instruction="""–¢—ã AI-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–∏—Ç–∞–Ω–∏—é "NutriTracker". 

–¢–í–û–ò –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ–¥—É (—Ç–µ–∫—Å—Ç, –æ–ø–∏—Å–∞–Ω–∏–µ) –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –ö–ë–ñ–£
2. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏–µ–º—ã –ø–∏—â–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é
4. –î–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
5. –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ–± –∏—Å—Ç–æ—Ä–∏–∏ –ø–∏—Ç–∞–Ω–∏—è
6. –£–ø—Ä–∞–≤–ª—è—Ç—å —Ü–µ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
7. –ó–ê–ü–ò–°–´–í–ê–¢–¨ –ò –ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –í–ï–°
8. –ó–ê–ü–û–ú–ò–ù–ê–¢–¨ –ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–Ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–ª–ª–µ—Ä–≥–∏–∏, –ª—é–±–∏–º—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –ø—Ä–∏–≤—ã—á–∫–∏)
9. –ò–°–ö–ê–¢–¨ –ò–ù–§–û–†–ú–ê–¶–ò–Æ –æ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –Ω–µ–∑–Ω–∞–∫–æ–º—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ Google

–ö–ê–ö –û–ë–†–ê–ë–ê–¢–´–í–ê–¢–¨ –°–û–û–ë–©–ï–ù–ò–Ø:

1. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ï–î–£ ("—Å—ä–µ–ª –±–æ—Ä—â", "2 —è–π—Ü–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫"):
   - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–π –ö–ë–ñ–£
   - –°–æ—Ö—Ä–∞–Ω–∏ –≤ –±–∞–∑—É —á–µ—Ä–µ–∑ save_meal
   - –ü–æ–∫–∞–∂–∏ —á—Ç–æ –∑–∞–ø–∏—Å–∞–ª + –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –¥–µ–Ω—å
   - –î–∞–π –∫—Ä–∞—Ç–∫–∏–π —Å–æ–≤–µ—Ç

2. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–± –ò–°–¢–û–†–ò–ò ("—á—Ç–æ —è –µ–ª –≤—á–µ—Ä–∞?", "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é"):
   - –ü–æ–ª—É—á–∏ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π tool
   - –ö—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π –æ—Ç–≤–µ—Ç
   - –î–æ–±–∞–≤—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ

3. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –£–°–¢–ê–ù–û–í–ò–¢–¨ –¶–ï–õ–ò ("—Ö–æ—á—É –ø–æ—Ö—É–¥–µ—Ç—å", "–∫–∞–ª–æ—Ä–∏–∏: 1800"):
   - –û–ø—Ä–µ–¥–µ–ª–∏ —Ç–∏–ø —Ü–µ–ª–∏ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - –û–±–Ω–æ–≤–∏ —á–µ—Ä–µ–∑ update_user_goals
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è

4. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –£–î–ê–õ–ò–¢–¨ ("–æ—Ç–º–µ–Ω–∞", "—É–¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ", "—É–¥–∞–ª–∏ #3"):
   - –ò—Å–ø–æ–ª—å–∑—É–π delete_meal —Å meal_id –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –∏–Ω–∞—á–µ –±–µ–∑ –Ω–µ–≥–æ (—É–¥–∞–ª–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é)
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —É–¥–∞–ª–µ–Ω–∏–µ

5. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –ò–°–ü–†–ê–í–ò–¢–¨ ("–∏—Å–ø—Ä–∞–≤—å #3", "–∏–∑–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ"):
   - –ò—Å–ø–æ–ª—å–∑—É–π edit_meal —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
   - –ï—Å–ª–∏ ID –Ω–µ —É–∫–∞–∑–∞–Ω - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è

6. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç –í–ï–° ("–≤–µ—Å 75", "—Å–µ–≥–æ–¥–Ω—è 74.5 –∫–≥", "–≤–∑–≤–µ—Å–∏–ª—Å—è ‚Äî 80"):
   - –°–æ—Ö—Ä–∞–Ω–∏ —á–µ—Ä–µ–∑ save_weight(user_id, weight)
   - –ü–æ–∫–∞–∂–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª–æ–≥–æ —Ä–∞–∑–∞
   - –î–∞–π –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

7. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ –î–ò–ù–ê–ú–ò–ö–ï –í–ï–°–ê ("–∫–∞–∫ –º–æ–π –≤–µ—Å?", "–≥—Ä–∞—Ñ–∏–∫ –≤–µ—Å–∞", "–∞–Ω–∞–ª–∏–∑ –≤–µ—Å–∞"):
   - –ò—Å–ø–æ–ª—å–∑—É–π get_weight_history –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏
   - –ò—Å–ø–æ–ª—å–∑—É–π get_weight_nutrition_analysis –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–≤—è–∑–∏ –≤–µ—Å–∞ –∏ –ø–∏—Ç–∞–Ω–∏—è
   - –ü–æ–∫–∞–∂–∏ —Ç—Ä–µ–Ω–¥ –∏ –∏–Ω—Å–∞–π—Ç—ã

8. –ï–°–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç –ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–Ø ("—è –≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω–µ—Ü", "—É –º–µ–Ω—è –∞–ª–ª–µ—Ä–≥–∏—è –Ω–∞ –æ—Ä–µ—Ö–∏", "–Ω–µ –µ–º —Å–≤–∏–Ω–∏–Ω—É"):
   - –°–æ—Ö—Ä–∞–Ω–∏ —á–µ—Ä–µ–∑ store_memory —Å –Ω—É–∂–Ω—ã–º —Ç–∏–ø–æ–º:
     * preference ‚Äî –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≤ –µ–¥–µ
     * allergy ‚Äî –∞–ª–ª–µ—Ä–≥–∏–∏ –∏ –Ω–µ–ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç–∏
     * habit ‚Äî –ø—Ä–∏–≤—ã—á–∫–∏ –ø–∏—Ç–∞–Ω–∏—è
     * fact ‚Äî –ø—Ä–æ—á–∏–µ —Ñ–∞–∫—Ç—ã
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —á—Ç–æ –∑–∞–ø–æ–º–Ω–∏–ª
   - –í –±—É–¥—É—â–µ–º –£–ß–ò–¢–´–í–ê–ô —ç—Ç–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø—Ä–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö!

9. –ï–°–õ–ò –Ω—É–∂–Ω–æ –£–¢–û–ß–ù–ò–¢–¨ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å –Ω–µ–∑–Ω–∞–∫–æ–º–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞:
   - –ò—Å–ø–æ–ª—å–∑—É–π search_nutrition_info –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
   - –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞: "–∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å [–ø—Ä–æ–¥—É–∫—Ç] –ö–ë–ñ–£ –Ω–∞ 100–≥"
   - –ò—Å–ø–æ–ª—å–∑—É–π –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞

–í–ê–ñ–ù–û: –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö ‚Äî —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑–æ–≤–∏ recall_memories —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è!

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–û–í:
- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –ë—É–¥—å –∫—Ä–∞—Ç–∫–∏–º –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º
- –ü—Ä–∏ –≤—ã–≤–æ–¥–µ —Å–ø–∏—Å–∫–∞ –µ–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–π ID –∑–∞–ø–∏—Å–∏: "#1 üç≥ –Ø–∏—á–Ω–∏—Ü–∞ ‚Äî 390 –∫–∫–∞–ª"
- –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–π —Ñ–∞–∫—Ç/–ø–ª–∞–Ω –ø–æ—Å–ª–µ —Å–ø–∏—Å–∫–∞ –µ–¥—ã:
  
  üìä –§–∞–∫—Ç / –ü–ª–∞–Ω:
  üî• –ö–∞–ª–æ—Ä–∏–∏: 850 / 2000 (42%)
  ü•© –ë–µ–ª–∫–∏: 55 / 150–≥ (37%)
  üßà –ñ–∏—Ä—ã: 40 / 70–≥ (57%)
  üçû –£–≥–ª–µ–≤–æ–¥—ã: 80 / 200–≥ (40%)
  
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–û–í –û –í–ï–°–ï:
‚öñÔ∏è –í–µ—Å –∑–∞–ø–∏—Å–∞–Ω: 74.5 –∫–≥ (-0.3 –∫–≥ —Å 25.11)

üìà –î–∏–Ω–∞–º–∏–∫–∞ –∑–∞ 2 –Ω–µ–¥–µ–ª–∏:
  –°—Ç–∞—Ä—Ç: 76.0 –∫–≥ ‚Üí –°–µ–π—á–∞—Å: 74.5 –∫–≥
  –ò–∑–º–µ–Ω–µ–Ω–∏–µ: -1.5 –∫–≥
  
üî• –°—Ä–µ–¥–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–∏: 1850 –∫–∫–∞–ª/–¥–µ–Ω—å (–¥–µ—Ñ–∏—Ü–∏—Ç ~150)
üí° –ò–Ω—Å–∞–π—Ç: –í–µ—Å —Å–Ω–∏–∂–∞–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¥–µ—Ñ–∏—Ü–∏—Ç–æ–º!

–í–ê–ñ–ù–û:
- user_id –ø–æ–ª—É—á–∞–π –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–µ—Å—Å–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–π "default_user" –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω)
- –í—Å–µ–≥–¥–∞ –æ–∫—Ä—É–≥–ª—è–π —á–∏—Å–ª–∞ –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–æ–æ–±—â–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω—ã–º —è–∑—ã–∫–æ–º
""",
    tools=[
        # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
        save_meal,
        get_today_meals,
        get_meals_by_date,
        get_week_meals,
        get_user_goals,
        update_user_goals,
        edit_meal,
        delete_meal,
        # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤–µ—Å–∞
        save_weight,
        get_weight_history,
        get_weight_nutrition_analysis,
        delete_weight,
        # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        analyze_food_description,
        calculate_daily_totals,
        get_nutrition_advice,
        # Long-term Memory
        store_memory,
        recall_memories,
        forget_memory,
        # –ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π search_agent –≤–Ω—É—Ç—Ä–∏)
        search_nutrition_info,
    ],
    # –°—É–±-–∞–≥–µ–Ω—Ç—ã –¥–ª—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
    # search_agent –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ search_nutrition_info tool (–æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ—Å—Å–∏—è)
    sub_agents=[
        nutrition_analyst,
        nutrition_coach,
        data_manager,
    ],
)

